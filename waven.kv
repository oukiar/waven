
#:import ScrollBox devslib.scrollbox
#:include devslib/utils.kv

<ModalAddPlaylist>:
    size_hint: (None, None)
    size: (350,280)
    title: "Create playlist"
    txt_title: txt_title
    BoxLayout:
        orientation: "vertical"
        padding: (40, 50)
        spacing: 10
        
        TextInput:
            id: txt_title
            hint_text: "Title"
            font_size: 22
            multiline: False
            on_text_validate: root.create_playlist()
        
        Button:
            text: "OK"
            on_release: root.create_playlist()
        
<PlayListItem@BoxLayout>:
	title:title
	
	size_hint_y: None
    height: "10mm"
    
 
    canvas:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            size: self.size
            pos: self.pos

    padding: 1
	
	ToggleButton:
		group: "playlistitem"
		id: title
        font_size:23
        background_color: 0.0,0.0,0.0,1
        on_release: root.update_tracklist()
    
        background_normal: ""

<Playlists>:
	items:items
    orientation: "vertical"
    spacing: 1
    AnchorLayout:
        size_hint_y: None
        height: 128
        BoxLayout:
            size_hint_x: None
            width: 300
        
        
            Button:
                size_hint_x: None
                background_normal: "images/prev.png"
                background_down: "images/prev_down.png"
        
            AnchorLayout:
                      
                ImageButton:
                    source: "images/circlepause.png"
                    #on_release: root.playpause(self)
                    
                RotativeImage:
                    source: "images/circle3.png"
                    #state: "rotating"
                    id: circle
                    
            Button:
                size_hint_x: None
                background_normal: "images/next.png"
                background_down: "images/next_down.png"
                #on_release: root.video.state = "stop"
            
            
    ScrollBox:
		id: items
        orientation: "vertical"
        bar_color: 0.89,0.559,0.270,1
        bar_inactive_color: 0.180,0.537,0.619,1
        scroll_distance: 100
        scroll_timeout: 400
        spacing: 5
        padding: 10
            
    BoxLayout:
        size_hint_y: None
        height: 60
        Button:
            text: "+"
            on_release: root.open_addplaylist()
        Button:
            text: "Menu"
            on_release: root.show_menu()
        Button:
            text: "Playing"
            on_release: app.root.show_playing()

<SongItem>:
    title:title
    height: 64
    
    BoxLayout:        
        canvas:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                size: self.size
                pos: self.pos
    
        padding: 1
    
        Button:
            id: title
            text: "Name of the song"
            background_normal: ""
            background_color: 0,0,0,1
            on_release: root.do_play()
            #text_size: (self.width, None)
            text_size: self.width-50, None
            size: self.texture_size
            font_size: 18
            
    Button:
        background_normal: "images/playnext_64.png"
        background_down: "images/playnext_down_64.png"
        width: 64
        size_hint_x: None
        on_release: root.do_playnext()



<ResultItem>:
    preview:preview
    title:title
    progress:progress
    layout_download:layout_download
    btn_download: btn_download
    
    size_hint_y: None
    spacing: 5
    
    AsyncImage:
        size_hint_x: None
        id: preview
        source: "images/video-preview.png"
    
    BoxLayout:
        orientation: "vertical"
        Label:
            id: title
            text_size: self.size
            font_size: 16
        BoxLayout:
            id: layout_download
            spacing: 5
            ProgressBar:
                id: progress
                value: 0
                max: 100
            Button:
                id: btn_download
                text: "Download"
                size_hint_x: None
                width: 120
                on_release: root.do_download()
                
<DownloadItem>:
    preview:preview
    title:title
    progress:progress
    layout_download:layout_download
    img_downloading:img_downloading
    
    size_hint_y: None
    spacing: 5
    
    Image:
        size_hint_x: None
        id: preview
        source: "images/video-preview.png"
    
    BoxLayout:
        orientation: "vertical"
        Label:
            id: title
            text_size: self.size
            font_size: 16
        BoxLayout:
            id: layout_download
            spacing: 5
            ProgressBar:
                id: progress
                value: 0
                max: 100
                
            AnchorLayout:
                id: img_downloading
                size_hint_x: None
                width: 120
                ImageButton:
                    source: "images/downloading.png"
                    on_release: root.playpause(self)
                    
                RotativeImage:
                    source: "images/downloadingcircle.png"
                    state: "rotating"
                
<ModalDownloads>:
    title: "Downloads"
    
    layout:layout
    
    BoxLayout:
        orientation: "vertical"
        
        ScrollBox:
            orientation: "vertical"
            padding: 20
            spacing: 5
            id: layout
            
            

<ModalSearch>:
    title: "Searching ..."
    layout:layout
    searchtext:searchtext
    
    BoxLayout:
        orientation: "vertical"
        
        AnchorLayout:
            size_hint_y: None
            height: 50
                
            BoxLayout:
                size_hint_x: None
                width: 400
                
                TextInput:
                    id: searchtext
                    hint_text: "Enter your search keywords"
                    font_size: 25
                    on_text_validate: root.on_search()
                    multiline: False
                
                Button:
                    text: "Search"
                    size_hint_x: None
                    on_release: root.on_search()
                                
                Button:
                    size_hint_x: None
                    width: 48
                    background_normal: "images/formatvideo_down.png"
                    background_down: "images/formatvideo.png"
                    on_release: root.show_formats()
                    
                Button:
                    size_hint: (None,None)
                    size: 40, 30
                    text: "URL"
                    on_release: root.open_downloadbyURL()

        ScrollBox:
            orientation: "vertical"
            padding: 20
            spacing: 5
            id: layout
            Label:
                text: "Searching"
                
        BoxLayout:
            size_hint_y: None
            height: 128
            Button:
                size_hint_x: None
                width: 128
                background_normal: "images/back.png"
                background_down: "images/back_down.png"
                on_release: root.dismiss()
            AnchorLayout:
                Button:
                    size_hint: None, None
                    size: 100,60
                    text: "Search more"
            
            RelativeLayout:
                size_hint_x: None
                width: 128
                Button:
                    background_normal: "images/downloads.png"
                    background_down: "images/downloads_down.png"
                    on_release: app.root.modaldownloads.open()
                
                RotativeImage:
                    source: "images/circle3.png"
                    state: "rotating"
                    id: circle
                    size_hint: 1, .65
                    #pos_hint: .1, .1
                    y: 11
                    
                Label:
                    text: "0"
                    color: 1,0,0,1
                    size_hint: None,None
                    size: (10,10)
                    pos_hint: {"right": .89, "top": .6}

<ModalDownloadByURL>:
    size_hint: None, None
    size: 300, 150
    title: "Paste the URL"

    txt_url: txt_url

    BoxLayout:
        orientation: "vertical"

        TextInput:
            hint_text: "Put the URL here"
            id: txt_url
            
        BoxLayout:
            
            Button:
                text: "Cancel"
                on_release: root.dismiss()
                
            Button:
                text: "OK"
                on_release: root.do_download()

<ModalPlaylistEdit>:
    title: "New playlist name"
    size_hint: None, None
    size: 300,200
    
    txt_newname: txt_newname
    
    BoxLayout:
        orientation: "vertical"
        TextInput:
            text: ""
            id: txt_newname
            hint_text: "New playlist name"
            
        Button:
            text: "Save"
            on_release: root.do_save()

<PlaylistMenu>:
    size_hint: None,None
    size: (200,400)
    title: "Playlist menu"
    BoxLayout:
        orientation: "vertical"
        Button:
            text: "Rename"
            font_size: 24
            on_release: root.do_rename()
        Button:
            text: "Delete"
            font_size: 24
            on_release: root.do_delete()
        Button:
            text: "Play All"
            font_size: 24
        Button:
            text: "Edit Tags"
            font_size: 24

<Waven>:

    screens:screens

	playlists:playlists
	songs:songs
	playing:playing
    txt_playing:txt_playing
    circle:circle
    video:video
    durationcounter:durationcounter
    playlisttitle:playlisttitle
    queuecounter:queuecounter
    videoprogress:videoprogress
    
    canvas:
        Color:
            rgba: 0, 0, 0, 1
        Rectangle:
            size: self.size
            pos: self.pos

    
    ScreenManager:
        id: screens
        
        Screen:
            name: "playlists"
            Playlists:
				id: playlists
        Screen:
            name: "songs"
            
            BoxLayout:
                orientation: "vertical"
                BoxLayout:
                    size_hint_y: None
                    height: 128
                    Label:
                        id: playlisttitle
                        text: "Playlist"
                        font_size: 30
                        #color: 0,0,0,1
                    AnchorLayout:
                        size_hint_x: None
                        width: 128
                        Button:
                            background_normal: "images/menu.png"
                            background_down: "images/menu_down.png"
                            size_hint: None, None
                            size: 64, 64
                            on_release: root.show_playlist_menu()
                ScrollBox:
                    id: songs
                    scroll_distance: 100
                    bar_color: 0.180,0.537,0.619,1
                    bar_inactive_color: 0.89,0.559,0.270,1
                    orientation: "vertical"
                    spacing: 3
                                                
                RelativeLayout:   
                    size_hint_y: None
                    height: 128
                
                    AnchorLayout:
                        anchor_x: "left"
                        Button:
                            size_hint_x: None
                            width: 128
                            background_normal: "images/back.png"
                            background_down: "images/back_down.png"
                            on_release: app.root.show_playlists()
                            
                    AnchorLayout:
                        anchor_x: "center"
                        Button:
                            size_hint_x: None
                            width: 128
                            background_normal: "images/search.png"
                            background_down: "images/search_down.png"
                            on_release: root.add_songs()
                            
                            
                    AnchorLayout:
                        anchor_x: "right" 
                              
                        ImageButton:
                            size_hint_x: None
                            width: 128 
                            source: "images/circleplay.png"
                            on_release: root.show_playing()
                            
                        RotativeImage:
                            size_hint_x: None
                            width: 128 
                            source: "images/circle3.png"
                            state: "rotating"
                            id: circle
                            

        Screen:
            name: "playing"
            
            canvas:
                Color:
                    rgba: 0.0, 0.0, 0.0, 1
                Rectangle:
                    size: self.size
                    pos: self.pos
            
            BoxLayout:
                spacing: 5
                id: playing
                orientation: "vertical"
                
                Label:
                    size_hint_y: None
                    height: 70
                    font_size: 26
                    text: "Now Playing"
                    color: 0.89,0.559,0.270,1
                    
                RelativeLayout:
                    size_hint_y: None
                    height: 70
                    
                    AnchorLayout:
                        anchor_x: "left"

                        Label:
                            font_size: 24
                            size_hint_y: None
                            height: 70
                            id: txt_playing
                            text: ""
                            #text_size: self.size
                            
                            text_size: self.width-50, None
                            size: self.texture_size
                    
                    AnchorLayout:
                        anchor_x: "right"

                        Label:
                            id: durationcounter
                            size_hint_x: None
                            font_size: 30
                            text: "00:00"
                            #color: 0.89,0.559,0.270,1
                    
                    
                Video:
					id: video
                    on_state: root.on_video_state(args[1])
                    on_loaded: root.on_videoloaded()
                    on_position: root.update_time(args[1])
                    
                AnchorLayout:
                    size_hint_y: None
                    height: 40
                    Slider:
                        id: videoprogress
                        size_hint_x: .8
                        on_value: root.seek_playing(args[1])
                    
                AnchorLayout:
                    size_hint_y: None
                    height: 100
                    
                    BoxLayout:
                        size_hint_x: None
                        width: 300
                        
                        Button:
                            size_hint_x: None
                            background_normal: "images/prev.png"
                            background_down: "images/prev_down.png"
                    
                        AnchorLayout:
                                  
                            ImageButton:
                                source: "images/circlepause.png"
                                on_release: root.playpause(self)
                                
                            RotativeImage:
                                source: "images/circle3.png"
                                #state: "rotating"
                                id: circle
                                
                        Button:
                            size_hint_x: None
                            background_normal: "images/next.png"
                            background_down: "images/next_down.png"
                            on_release: root.video.state = "stop"
                    
                RelativeLayout:   
                    size_hint_y: None
                    height: 128
                
                    AnchorLayout:
                        anchor_x: "left"
                        Button:
                            size_hint_x: None
                            width: 128
                            background_normal: "images/back.png"
                            background_down: "images/back_down.png"
                            on_release: root.show_songs(direction="right")
                            
                    AnchorLayout:     
                        anchor_x: "right"                        
                        anchor_y: "bottom"                        
                        Button:
                            size_hint_x: None
                            width: 128
                            background_normal: "images/queue.png"
                            background_down: "images/queue_down.png"
                            
                        Label:
                            id: queuecounter
                            size_hint_x: None
                            width: 100
                            size_hint_y: None
                            height: 105
                            color: (1,0,0,1)
                            text: "0"
                    
                

<Desktop>:

	playlists:playlists
	songs:songs
	video:video
    txt_playing:txt_playing
    circle:circle
    
    canvas:
        Color:
            rgba: 0.0666, 0.09019, 0.09803, 1
        Rectangle:
            size: self.size
            pos: self.pos

    BoxLayout:
        orientation: "vertical"
        spacing: 30
                    
        AnchorLayout:
            size_hint_y: None
            height: 80
            BoxLayout:
                spacing: 5
                Label:
                    size_hint_x: None
                    width: 150
                    text: "Now Playing"
                    color: 0.89,0.559,0.270,1
                    
                AnchorLayout:
                    size_hint_x: None
                    width: 100
                          
                    ImageButton:
                        source: "images/circlepause.png"
                        on_release: root.playpause(self)
                        
                    RotativeImage:
                        source: "images/circle3.png"
                        #state: "rotating"
                        id: circle
                    
                Label:
                    id: txt_playing
                    text: ""
                Video:
                    size_hint_x: None
                    width: 120
					id: video
                    on_state: root.on_video_state(args[1])
                    
                Image:
                    size_hint_x: None
                    width: 60
                    source: "images/queuecount.png"

        BoxLayout:
            Playlists:
				id: playlists
                size_hint_x: None
                width: 350

            BoxLayout:
                orientation: "vertical"
                ScrollBox:
                    id: songs
                    bar_color: 0.180,0.537,0.619,1
                    bar_inactive_color: 0.89,0.559,0.270,1
                    orientation: "vertical"
                AnchorLayout:
                    size_hint_y: None
                    height: 60
                    Button:
                        size_hint_x: None
                        width: 200
                        text: "Add songs"
                        on_release: root.add_songs()
                
                
